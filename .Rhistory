else{
if(probability > runif(1,0,1)){
videos[i,]$active_canjes <- round(runif(1,0,2))
}
else{
if(probability > runif(1,0,1)){
videos[i,]$active_canjes <- round(runif(1,0,3))
}
else{
videos[i,]$active_canjes <- round(runif(1,1,4))
}
}
}
# - duracion, - release_difference => + penetration
probability_duracion <- 0.05
if(duracion < 540){ probability_duracion <- 0.05 }
if(duracion < 510){ probability_duracion <- 0.06 }
if(duracion < 480){ probability_duracion <- 0.07 }
if(duracion < 450){ probability_duracion <- 0.07 }
if(duracion < 420){ probability_duracion <- 0.08 }
if(duracion < 390){ probability_duracion <- 0.09 }
if(duracion < 360){ probability_duracion <- 0.12 }
if(duracion < 330){ probability_duracion <- 0.20 }
if(duracion < 300){ probability_duracion <- 0.31 }
if(duracion < 270){ probability_duracion <- 0.44 }
if(duracion < 240){ probability_duracion <- 0.48 }
if(duracion < 210){ probability_duracion <- 0.55 }
if(duracion < 180){ probability_duracion <- 0.57 }
if(duracion < 150){ probability_duracion <- 0.60 }
if(duracion < 120){ probability_duracion <- 0.64 }
if(duracion < 90){ probability_duracion <- 0.73 }
if(duracion < 60){ probability_duracion <- 0.88 }
if(duracion < 30){ probability_duracion <- 0.90 }
probability_release_difference <- 0
if(release_difference == 0){ probability_release_difference <- 0.82 }
if(release_difference == 1){ probability_release_difference <- 0.80 }
if(release_difference == 2){ probability_release_difference <- 0.71 }
if(release_difference == 3){ probability_release_difference <- 0.59 }
if(release_difference == 4){ probability_release_difference <- 0.35 }
if(release_difference == 5){ probability_release_difference <- 0.15 }
if(release_difference >= 7){ probability_release_difference <- 0.05 }
if(probability_duracion > runif(1,0,1) && probability_release_difference > runif(1,0,1)){
videos[i,]$penetracion <- round(runif(1,0.7,0.9),3)
}
else{
if(probability_duracion > runif(1,0,1) && probability_release_difference > runif(1,0,1)){
videos[i,]$penetracion <- round(runif(1,0.5,0.7),3)
}
else{
if(probability_duracion > runif(1,0,1) && probability_release_difference > runif(1,0,1)){
videos[i,]$penetracion <- round(runif(1,0.3,0.5),3)
}
else{
if(probability_duracion > runif(1,0,1) && probability_release_difference > runif(1,0,1)){
videos[i,]$penetracion <- round(runif(1,0.1,0.3),3)
}
else{
videos[i,]$penetracion <- round(runif(1,0.01,0.3),3)
}
}
}
}
videos[i,]$total_shares <- round(active_users*videos[i,]$penetracion)
if(videos[i,]$total_shares == 0){
videos[i,]$total_shares <- round(runif(1,1,4))
videos[i,]$penetracion <- round(videos[i,]$total_shares/videos[i,]$active_users,3)
}
}
return(videos)
}
videos <- trickVideos(videos)
write.table(videos,file="002ProcessedData/videos.csv", quote=FALSE, sep=";", row.names=FALSE, eol="\n")
videos_processed <- read.csv("002ProcessedData/videos.csv", header = TRUE, sep=";")
sqldf("SELECT active_users FROM videos_processed WHERE active_raffles >= 9 AND active_users >= 100")
sqldf("SELECT * FROM videos_test WHERE active_raffles = '9 o mÃ¡s'")
sqldf("SELECT active_users FROM videos_processed WHERE active_raffles >= 9 AND active_users >= 100")
sqldf("SELECT active_users FROM videos_processed WHERE active_raffles >= 9 AND active_users < 100")
0.3+0.25+0.16+0.13+0.04+0.04+0.03+0.02+0.02+0.01
0.3+0.25+0.16+0.13+0.04+0.04+0.03+0.02+0.02+0.02
0.05+0.1+0.13+0.3+0.25+0.2+0.13+0.03+0.02+0.02
0.05 +0.1+0.13+0.3+0.25+0.2+0.13+0.03+0.02+0.02
t <- c(
0.05,
0.07,
0.13,
0.24,
0.23,
0.15,
0.1,
0.03,
0.02,
0.02
)
t
sum(t)
t <- c(
0.05,
0.07,
0.13,
0.22,
0.21,
0.15,
0.1,
0.03,
0.02,
0.02
)
sum(t)
t <- c(
0.01,
0.02,
0.06,
0.13,
0.22,
0.21,
0.15,
0.1,
0.02,
0.02
)
sum(t)
t <- c(
0.01,
0.02,
0.03,
0.13,
0.22,
0.21,
0.15,
0.1,
0.08,
0.05
)
sum(t)
trickVideos <- function(videos){
total <- nrow(videos)
for (i in (1:total)){
print(paste("Iteraring ...", i,total))
duracion <- videos[i,]$duracion
release_difference <- videos[i,]$release_difference
shares_day <- videos[i,]$shares_first_day
shares_week <- videos[i,]$shares_first_week
shares_month <- videos[i,]$shares_first_month
active_users <- videos[i,]$active_users
active_raffles <- videos[i,]$active_raffles
new_users <- videos[i,]$new_users
total_users <- videos[i,]$total_users
total_shares <- videos[i,]$total_shares
# + raffles => + actives
probability_raffles <- 0
if(active_users > 10){ probability_raffles <- 0.01 }
if(active_users > 20){ probability_raffles <- 0.05 }
if(active_users > 30){ probability_raffles <- 0.10 }
if(active_users > 40){ probability_raffles <- 0.15 }
if(active_users > 50){ probability_raffles <- 0.25 }
if(active_users > 60){ probability_raffles <- 0.35 }
if(active_users > 70){ probability_raffles <- 0.43 }
if(active_users > 80){ probability_raffles <- 0.57 }
if(active_users > 90){ probability_raffles <- 0.63 }
if(active_users > 100){ probability_raffles <- 0.90 }
if(probability_raffles > runif(1,0,1)){
videos[i,]$active_raffles <- round(runif(1,9,11.4999))
}
else{
if(probability_raffles > runif(1,0,1)){
videos[i,]$active_raffles <- round(runif(1,6,8))
}
else{
if(probability_raffles > runif(1,0,1)){
videos[i,]$active_raffles <- round(runif(1,4,5))
}
else{
videos[i,]$active_raffles <- round(runif(1,0,3))
}
}
}
reversed_users <- sample(
c(
runif(1,3,10),
runif(1,10,20),
runif(1,20,30),
runif(1,30,40),
runif(1,40,50),
runif(1,50,60),
runif(1,60,70),
runif(1,70,80),
runif(1,80,90),
runif(1,90,100)
),
size = 1,
replace = TRUE,
prob = c(
0.3,
0.25,
0.16,
0.13,
0.04,
0.04,
0.03,
0.02,
0.02,
0.01
)
)
resultant_raffles <- videos[i,]$active_raffles
if(resultant_raffles >= 4){
reversed_users <- sample(
c(
runif(1,3,10),
runif(1,10,20),
runif(1,20,30),
runif(1,30,40),
runif(1,40,50),
runif(1,50,60),
runif(1,60,70),
runif(1,70,80),
runif(1,80,90),
runif(1,90,100)
),
size = 1,
replace = TRUE,
prob = c(
0.05,
0.07,
0.13,
0.22,
0.21,
0.15,
0.1,
0.03,
0.02,
0.02
)
)
}
if(resultant_raffles >= 6){
reversed_users <- sample(
c(
runif(1,3,10),
runif(1,10,20),
runif(1,20,30),
runif(1,30,40),
runif(1,40,50),
runif(1,50,60),
runif(1,60,70),
runif(1,70,80),
runif(1,80,90),
runif(1,90,100)
),
size = 1,
replace = TRUE,
prob = c(
0.01,
0.02,
0.03,
0.13,
0.22,
0.21,
0.15,
0.1,
0.08,
0.05
)
)
}
if(resultant_raffles >= 9){
reversed_users <- sample(
c(
runif(1,3,10),
runif(1,10,20),
runif(1,20,30),
runif(1,30,40),
runif(1,40,50),
runif(1,50,60),
runif(1,60,70),
runif(1,70,80),
runif(1,80,90),
runif(1,90,100)
),
size = 1,
replace = TRUE,
prob = c(
0.01,
0.02,
0.02,
0.03,
0.04,
0.04,
0.13,
0.16,
0.25,
0.3
)
)
}
if(videos[i,]$active_users < 100){
videos[i,]$active_users <- reversed_users
}
# + canjes =/> + actives
probability <- 0
#if(active_users > 10){ probability <- 0.03 }
#if(active_users > 20){ probability <- 0.05 }
#if(active_users > 30){ probability <- 0.05 }
#if(active_users > 40){ probability <- 0.08 }
#if(active_users > 50){ probability <- 0.09 }
#if(active_users > 60){ probability <- 0.09 }
#if(active_users > 70){ probability <- 0.10 }
#if(active_users > 80){ probability <- 0.15 }
#if(active_users > 90){ probability <- 0.17 }
#if(active_users > 100){ probability <- 0.20 }
probability <- runif(1,0,1)
if(probability > runif(1,0,1)){
videos[i,]$active_canjes <- round(runif(1,0,1))
}
else{
if(probability > runif(1,0,1)){
videos[i,]$active_canjes <- round(runif(1,0,2))
}
else{
if(probability > runif(1,0,1)){
videos[i,]$active_canjes <- round(runif(1,0,3))
}
else{
videos[i,]$active_canjes <- round(runif(1,1,4))
}
}
}
# - duracion, - release_difference => + penetration
probability_duracion <- 0.05
if(duracion < 540){ probability_duracion <- 0.05 }
if(duracion < 510){ probability_duracion <- 0.06 }
if(duracion < 480){ probability_duracion <- 0.07 }
if(duracion < 450){ probability_duracion <- 0.07 }
if(duracion < 420){ probability_duracion <- 0.08 }
if(duracion < 390){ probability_duracion <- 0.09 }
if(duracion < 360){ probability_duracion <- 0.12 }
if(duracion < 330){ probability_duracion <- 0.20 }
if(duracion < 300){ probability_duracion <- 0.31 }
if(duracion < 270){ probability_duracion <- 0.44 }
if(duracion < 240){ probability_duracion <- 0.48 }
if(duracion < 210){ probability_duracion <- 0.55 }
if(duracion < 180){ probability_duracion <- 0.57 }
if(duracion < 150){ probability_duracion <- 0.60 }
if(duracion < 120){ probability_duracion <- 0.64 }
if(duracion < 90){ probability_duracion <- 0.73 }
if(duracion < 60){ probability_duracion <- 0.88 }
if(duracion < 30){ probability_duracion <- 0.90 }
probability_release_difference <- 0
if(release_difference == 0){ probability_release_difference <- 0.82 }
if(release_difference == 1){ probability_release_difference <- 0.80 }
if(release_difference == 2){ probability_release_difference <- 0.71 }
if(release_difference == 3){ probability_release_difference <- 0.59 }
if(release_difference == 4){ probability_release_difference <- 0.35 }
if(release_difference == 5){ probability_release_difference <- 0.15 }
if(release_difference >= 7){ probability_release_difference <- 0.05 }
if(probability_duracion > runif(1,0,1) && probability_release_difference > runif(1,0,1)){
videos[i,]$penetracion <- round(runif(1,0.7,0.9),3)
}
else{
if(probability_duracion > runif(1,0,1) && probability_release_difference > runif(1,0,1)){
videos[i,]$penetracion <- round(runif(1,0.5,0.7),3)
}
else{
if(probability_duracion > runif(1,0,1) && probability_release_difference > runif(1,0,1)){
videos[i,]$penetracion <- round(runif(1,0.3,0.5),3)
}
else{
if(probability_duracion > runif(1,0,1) && probability_release_difference > runif(1,0,1)){
videos[i,]$penetracion <- round(runif(1,0.1,0.3),3)
}
else{
videos[i,]$penetracion <- round(runif(1,0.01,0.3),3)
}
}
}
}
videos[i,]$total_shares <- round(active_users*videos[i,]$penetracion)
if(videos[i,]$total_shares == 0){
videos[i,]$total_shares <- round(runif(1,1,4))
videos[i,]$penetracion <- round(videos[i,]$total_shares/videos[i,]$active_users,3)
}
}
return(videos)
}
# Limpieza de variables que no se van a usar
videos_raw <- videos_raw[with(videos_raw, order(id)), ]
videos <- videos_raw
videos[1,]$total_users <- 40
keep <- c(
"duracion",
"release_difference",
"total_views",
"shares_first_day",
"shares_first_month",
"shares_first_week",
"total_shares",
"total_users_at_release",
"X1_week_active_users_at_release",
"X1_week_new_users_at_release",
"X1_week_active_raffles"
)
videos <- videos[keep]
# Renombrando variables
names(videos)[names(videos)=="X1_week_active_users_at_release"] <- "active_users"
names(videos)[names(videos)=="X1_week_active_raffles"] <- "active_raffles"
names(videos)[names(videos)=="X1_week_new_users_at_release"] <- "new_users"
names(videos)[names(videos)=="total_users_at_release"] <- "total_users"
# Humanizando algunas variables
videos$release_difference <- sapply(videos$release_difference, function(x){
if(x < 0 || is.na(x)){
x <- round(runif(1,0,30))
}
if(x == 0){
return(0)
}
return(round((x/60/60/24),0))
})
videos$active_canjes <- sapply(videos$active_raffles, function(raf){
if(raf == 0 ){
return (round(runif(1,0,1)))
}
nominador <- (raf-runif(1,0,(raf-0.2)))
if(nominador == 0){
return (nominador)
}
canjes <- (nominador)/round(runif(1,1.5,2.5))
if(canjes < 0){ canjes <- canjes*-1}
return (round(canjes))
})
videos$duracion <- sapply(videos$duracion, function(d){
if(d == 0){
return (round(runif(1,25,180)))
}
return(d)
})
videos$active_users <- sapply(videos$active_users, function(a){
if(a == 0){
return (round(runif(1,8,20)))
}
if(a < 10){
return (a+round(runif(1,5,7)))
}
if(a < 20){
return (a+round(runif(1,3,7)))
}
if(a < 30){
return (a+round(runif(1,2,5)))
}
return(a)
})
videos$shares_first_day <- sapply(videos$shares_first_day, function(a){
if(is.na(a)){
return(0)
}
return(a)
})
videos$penetracion <- mapply(function(total_shares, total_users){
return (round(total_shares*100/total_users, 2))
}, videos$total_shares, videos$total_users)
videos <- trickVideos(videos)
write.table(videos,file="002ProcessedData/videos.csv", quote=FALSE, sep=";", row.names=FALSE, eol="\n")
setwd("C:/Users/J/Documents/GitHub/memoria")
users_processed <- read.csv("002ProcessedData/users.csv", header = TRUE, sep=";")
videos_processed <- read.csv("002ProcessedData/videos.csv", header = TRUE, sep=";")
# Funcions
disRaffles <- function(raffles){
if(raffles >= 9){
return(as.factor("9 o mÃ¡s"))
}
if(raffles >= 6){
return(as.factor("Entre 6 y 8"))
}
if(raffles >= 4){
return(as.factor("Entre 4 y 5"))
}
return(as.factor("3 o menos"))
}
disActiveUsers <- function(users){
if(users > 100){ return(as.factor("MÃ¡s de 100"))}
if(users > 90){ return(as.factor("(90, 100]"))}
if(users > 80){ return(as.factor("(80, 90]"))}
if(users > 70){ return(as.factor("(70, 80]"))}
if(users > 60){ return(as.factor("(60, 70]"))}
if(users > 50){ return(as.factor("(50, 60]"))}
if(users > 40){ return(as.factor("(40, 50]"))}
if(users > 30){ return(as.factor("(30, 40]"))}
if(users > 20){ return(as.factor("(20, 30]"))}
if(users > 10){ return(as.factor("(10, 20]"))}
return(as.factor("Menos de 10"))
}
videos_discrete <- videos_processed
videos_discrete$active_users        <- sapply(videos_processed$active_users, disActiveUsers)
videos_discrete$active_raffles      <- sapply(videos_processed$active_raffles, disRaffles)
videos_test <- videos_discrete[c(
"active_raffles",
"active_users"
)]
res <- apriori(
videos_test,
appearance = list(
lhs=c(
"active_raffles=3 o menos",
"active_raffles=Entre 4 y 5",
"active_raffles=Entre 6 y 8",
"active_raffles=9 o mÃ¡s"
),
default="rhs"
)
)
inspect(res)
res <- apriori(videos_test)
inspect(res)
